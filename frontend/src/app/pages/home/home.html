<app-header 
  [searchInput]="searchInput"
  (mobileMenuToggled)="onMobileMenuToggle()">
</app-header>

<!-- Mobile Search Bar -->
<div class="mobile-search-container" *ngIf="isMobile">
  <div class="mobile-search-bar">
    <input 
      type="text" 
      placeholder="Search therapists..." 
      class="mobile-search-input"
      [formControl]="searchInput">
    <button 
      *ngIf="searchInput.value" 
      class="clear-search-btn"
      (click)="clearSearch()"
      aria-label="Clear search">
      Ã—
    </button>
  </div>
  <div class="mobile-filter-tag" *ngIf="activeFilterCount > 0">
    <span class="filter-tag-text">Filters Applied: {{ activeFilterCount }}</span>
  </div>
</div>

<!-- Mobile Menu Backdrop -->
<div class="mobile-backdrop" 
     *ngIf="isMobile && isMobileMenuOpen" 
     (click)="onBackdropClick()">
</div>

<div class="layout">
    <aside class="left" 
           role="complementary" 
           [class.mobile-hidden]="isMobile && !isMobileMenuOpen"
           [class.mobile-visible]="isMobile && isMobileMenuOpen">
        <app-filter-panel
          [options]="options"
          [filters]="filters"
          [isMobile]="isMobile"
          (filtersChange)="onFiltersChange($event)"
          (closeMobileMenu)="onMobileMenuToggle()">
        </app-filter-panel>
    </aside>
  
    <main class="right">
      <div class="results-info">
        <div class="results-header">
          <span class="results-count">{{total}} therapists found</span>
          <div class="filter-info" *ngIf="activeFilterCount > 0">
            <span class="filter-count">{{activeFilterCount}} filter{{activeFilterCount > 1 ? 's' : ''}} applied</span>
            <!-- <button class="clear-filters-btn" (click)="clearAllFilters()">Clear All</button> -->
          </div>
        </div>
      </div>
  
      <!-- Loading State -->
      <div *ngIf="loading" class="loading-state">
        <div class="loading-spinner"></div>
        <p>Loading therapists...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error && !loading" class="error-state">
        <p class="error-message">{{ error }}</p>
        <button class="retry-button" (click)="loadTherapists()">Retry</button>
      </div>

      <!-- Results Grid -->
      <section class="results-grid" *ngIf="!loading && !error">
        <app-therapist-card 
          *ngFor="let t of therapists" 
          [therapist]="t"
          (viewDetails)="onViewTherapistDetails($event)">
        </app-therapist-card>
      </section>

      <!-- No Results -->
      <div *ngIf="!loading && !error && therapists.length === 0" class="no-results">
        <p>No therapists found matching your criteria.</p>
        <button class="clear-filters-btn" (click)="clearAllFilters()">Clear Filters</button>
      </div>

      <!-- Pagination -->
      <div class="pagination-container" *ngIf="!loading && !error && therapists.length > 0">
        <div class="pagination-info">
          <span>Showing {{ getStartIndex() }} - {{ getEndIndex() }} of {{ total }} therapists</span>
        </div>
        
        <div class="pagination-controls">
          <button 
            class="pagination-btn" 
            [disabled]="page === 1"
            (click)="goToPage(page - 1)">
            Previous
          </button>
          
          <div class="page-numbers">
            <button 
              *ngFor="let pageNum of getPageNumbers()" 
              class="page-number"
              [class.active]="pageNum === page"
              (click)="goToPage(pageNum)">
              {{ pageNum }}
            </button>
          </div>
          
          <button 
            class="pagination-btn" 
            [disabled]="page >= getTotalPages()"
            (click)="goToPage(page + 1)">
            Next
          </button>
        </div>
        
        <div class="load-more-container">
          <button 
            class="load-more-btn" 
            *ngIf="therapists.length < total && !loadingMore"
            (click)="loadMore()">
            Load More
          </button>
          <div *ngIf="loadingMore" class="loading-more">
            <span class="loading-spinner"></span>
            Loading more therapists...
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Therapist Detail Popup -->
  <app-therapist-detail
    [therapist]="selectedTherapist"
    [isOpen]="isPopupOpen"
    (close)="onClosePopup()">
  </app-therapist-detail>